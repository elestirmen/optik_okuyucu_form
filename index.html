<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Optik Form Tasarla & Oku - Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/styles.css">
  
  <script src="assets/js/opencv-init.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script async src="https://docs.opencv.org/4.x/opencv.js" onload="cv['onRuntimeInitialized']=onOpenCvReady;"></script>
</head>
<body>
  <div class="app">
    <header class="no-print">
      <h1>âš¡ Optik Form Pro</h1>
      <span class="badge" id="cv-status">OpenCV...</span>
      <div class="tabs">
        <button class="active" data-view="designer">ğŸ“ Tasarla</button>
        <button data-view="reader">ğŸ“· Oku</button>
      </div>
    </header>

    <main>
      <!-- ===== DESIGNER ===== -->
      <section id="designer" class="view active">
        <div class="grid">
          <div class="card">
            <h3>âš™ï¸ Form AyarlarÄ±</h3>
            <div class="hint">Kompakt optik form tasarÄ±mÄ± - tÃ¼m boyutlar ayarlanabilir</div>
            
            <div class="param-grid">
              <div><label>Soru SayÄ±sÄ±</label><input type="number" id="questionCount" min="1" max="200" value="30"></div>
              <div><label>ÅÄ±k SayÄ±sÄ±</label>
                <select id="choiceCount">
                  <option value="4">4 (A-D)</option>
                  <option value="5" selected>5 (A-E)</option>
                </select>
              </div>
              <div><label>Soru SÃ¼tunu</label>
                <select id="columnCount">
                  <option value="1">1</option>
                  <option value="2" selected>2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                </select>
              </div>
              <div><label>Ã–ÄŸr. No Hane</label><input type="number" id="studentDigits" min="4" max="15" value="10"></div>
              <div><label>Cevap AnahtarÄ±</label>
                <select id="showAnswerKey">
                  <option value="yes" selected>GÃ¶ster</option>
                  <option value="no">Gizle</option>
                </select>
              </div>
              <div><label>Anahtar ÅÄ±k</label><input type="number" id="answerKeyChoices" min="4" max="10" value="10"></div>
            </div>
            
            <div class="param-grid" style="margin-top:8px;">
              <div><label>Form GeniÅŸlik (px)</label><input type="number" id="formWidth" min="300" max="1200" value="350" step="50"></div>
              <div><label>Form YÃ¼kseklik (px)</label><input type="number" id="formHeight" min="400" max="2000" value="550" step="50"></div>
              <div><label>Baloncuk Boyutu</label><input type="number" id="bubbleSize" min="8" max="24" value="14" step="1"></div>
              <div><label>SatÄ±r AralÄ±ÄŸÄ±</label><input type="number" id="rowGap" min="1" max="20" value="4" step="1"></div>
              <div><label>Kalite Ã‡arpanÄ±</label>
                <select id="qualityScale">
                  <option value="1">1x (HÄ±zlÄ±)</option>
                  <option value="2" selected>2x (Normal)</option>
                  <option value="3">3x (YÃ¼ksek)</option>
                  <option value="4">4x (Ã‡ok YÃ¼ksek)</option>
                </select>
              </div>
              <div><label>Harf Tekrar (soru)</label><input type="number" id="headerRepeat" min="3" max="20" value="5" step="1"></div>
            </div>
            
            <div class="param-grid" style="margin-top:8px;">
              <div><label>SÄ±nav Kodu</label><input type="text" id="examId" value="SINAV-001"></div>
              <div><label>Web Adresi</label><input type="text" id="webUrl" value="optikform.com"></div>
            </div>
            
            <div class="btn-group">
              <button class="btn" id="refreshBtn">ğŸ”„ OluÅŸtur</button>
              <button class="btn secondary" id="downloadPngBtn">ğŸ“¥ PNG Ä°ndir</button>
              <button class="btn secondary" id="downloadPdfBtn">ğŸ–¨ï¸ YazdÄ±r</button>
            </div>
          </div>
          
          <div class="card">
            <h3>ğŸ‘ï¸ Ã–nizleme</h3>
            <div class="hint">Form canvas Ã¼zerine Ã§izilir - PNG olarak indirilebilir</div>
            <div class="form-preview-wrap">
              <canvas id="formCanvas"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== READER ===== -->
      <section id="reader" class="view">
        <div class="grid">
          <div class="card">
            <h3>ğŸ”‘ Cevap AnahtarÄ±</h3>
            <div class="hint">Cevap anahtarÄ±nÄ± manuel girin veya form tarayarak yÃ¼kleyin</div>
            
            <div class="param-grid" style="margin-bottom:10px;">
              <div>
                <label>Anahtar KaynaÄŸÄ±</label>
                <select id="answerKeySource">
                  <option value="manual" selected>Manuel GiriÅŸ</option>
                  <option value="scan">Tarayarak YÃ¼kle</option>
                </select>
              </div>
              <div>
                <label>Soru SayÄ±sÄ±</label>
                <input type="number" id="answerKeyCount" min="1" max="200" value="30">
              </div>
            </div>
            
            <div id="manualKeySection">
              <div class="btn-group" style="margin-bottom:8px;">
                <button class="btn secondary" id="generateKeyGridBtn" style="padding:6px 12px;font-size:11px;">ğŸ“‹ Anahtar Tablosu OluÅŸtur</button>
                <button class="btn secondary" id="clearKeyBtn" style="padding:6px 12px;font-size:11px;">ğŸ—‘ï¸ Temizle</button>
                <button class="btn secondary" id="randomKeyBtn" style="padding:6px 12px;font-size:11px;">ğŸ² Rastgele</button>
              </div>
              <div class="answer-key-grid" id="answerKeyGrid">
                <!-- Dinamik olarak oluÅŸturulacak -->
              </div>
            </div>
            
            <div id="scanKeySection" style="display:none;">
              <div class="btn-group">
                <button class="btn" id="scanKeyBtn">ğŸ“· Cevap AnahtarÄ± Tara</button>
              </div>
              <div class="hint" style="margin-top:8px;">Cevap anahtarÄ± formunu tarayÄ±n. Ä°ÅŸaretli cevaplar otomatik kaydedilecek.</div>
            </div>
            
            <div class="answer-key-status empty" id="answerKeyStatus">
              âš ï¸ Cevap anahtarÄ± henÃ¼z girilmedi
            </div>
          </div>
          
          <div class="card">
            <h3>ğŸ“· Form Okuma</h3>
            <div class="hint">Kamera veya dosyadan resim yÃ¼kleyerek formu okuyun</div>
            
            <div class="param-grid" style="margin-bottom:10px;">
              <div>
                <label>Kaynak</label>
                <select id="scanSource">
                  <option value="camera" selected>ğŸ“· Kamera</option>
                  <option value="file">ğŸ“ Dosyadan YÃ¼kle</option>
                </select>
              </div>
            </div>
            <div class="param-grid" id="cameraSelectRow" style="margin-bottom:10px;">
              <div>
                <label>Kamera</label>
                <select id="cameraSelect">
                  <option value="">Otomatik (arka kamera)</option>
                </select>
              </div>
            </div>
            
            <!-- Kamera BÃ¶lÃ¼mÃ¼ -->
            <div id="cameraSection">
              <div class="video-wrap">
                <video id="video" playsinline></video>
                <div class="overlay"></div>
                <div class="scan-status" id="scanStatus"><div class="dot"></div><span id="scanStatusText">Bekleniyor</span></div>
              </div>
              <div class="btn-group">
                <button class="btn" id="startCameraBtn">ğŸ“· KamerayÄ± BaÅŸlat</button>
                <button class="btn secondary" id="captureBtn" disabled>ğŸ“¸ Ã–ÄŸrenci Formu Tara</button>
                <button class="btn secondary" id="autoScanBtn">ğŸ”„ Otomatik</button>
              </div>
            </div>
            
            <!-- Dosya YÃ¼kleme BÃ¶lÃ¼mÃ¼ -->
            <div id="fileSection" style="display:none;">
              <div style="border:2px dashed var(--border);border-radius:8px;padding:20px;text-align:center;margin-bottom:10px;">
                <input type="file" id="fileInput" accept="image/*" style="display:none;">
                <button class="btn" onclick="document.getElementById('fileInput').click()">ğŸ“ Resim SeÃ§</button>
                <div class="hint" style="margin-top:8px;">PNG, JPG veya JPEG formatÄ±nda form resmi yÃ¼kleyin</div>
                <div id="fileName" style="margin-top:8px;font-size:11px;color:var(--muted);"></div>
              </div>
              <div class="btn-group">
                <button class="btn secondary" id="processFileBtn" disabled>ğŸ” Formu Analiz Et</button>
                <button class="btn secondary" id="clearFileBtn" style="display:none;">ğŸ—‘ï¸ Temizle</button>
              </div>
            </div>
            
            <div class="settings-row">
              <label>EÅŸik: <input type="number" id="fillThreshold" value="0.20" min="0.1" max="0.9" step="0.02"></label>
              <label>Ceza: <input type="number" id="penalty" value="0.25" min="0" max="1" step="0.05"></label>
            </div>
            <div class="log" id="cameraLog">Kaynak seÃ§in ve formu yÃ¼kleyin.</div>
          </div>
          
          <div class="card">
            <h3>ğŸ“Š SonuÃ§lar</h3>
            <div class="canvas-row">
              <div class="canvas-item"><div class="label">Yakalanan</div><canvas id="captureCanvas" class="process-canvas"></canvas></div>
              <div class="canvas-item"><div class="label">Marker</div><canvas id="markerCanvas" class="process-canvas"></canvas></div>
              <div class="canvas-item"><div class="label">DÃ¼zeltilmiÅŸ</div><canvas id="warpCanvas" class="process-canvas"></canvas></div>
            </div>
            <div class="result-box" id="omrResult">
              <div class="summary">
                <div class="stat correct"><div class="stat-value">-</div><div class="stat-label">DoÄŸru</div></div>
                <div class="stat wrong"><div class="stat-value">-</div><div class="stat-label">YanlÄ±ÅŸ</div></div>
                <div class="stat"><div class="stat-value">-</div><div class="stat-label">BoÅŸ</div></div>
                <div class="stat net"><div class="stat-value">-</div><div class="stat-label">Net</div></div>
              </div>
              <div class="result-details" id="resultDetails">SonuÃ§lar burada...</div>
            </div>
            <div class="btn-group" style="margin-top:10px;">
              <button class="btn secondary" id="downloadTxtBtn" style="padding:6px 10px;font-size:11px;">TXT Listesi</button>
              <button class="btn secondary" id="downloadCsvBtn" style="padding:6px 10px;font-size:11px;">Excel (CSV)</button>
              <button class="btn secondary" id="downloadXlsxBtn" style="padding:6px 10px;font-size:11px;">Excel (XLSX)</button>
              <span id="sessionCount" style="font-size:11px;color:var(--muted);">0 kayit</span>
            </div>
            <div class="result-details" id="sessionList">Henuz kayit yok.</div>
            <div class="log" id="omrLog">HazÄ±r.</div>
          </div>
        </div>
      </section>
    </main>
  </div>
  <script src="assets/js/app.js"></script>
</body>
</html>
